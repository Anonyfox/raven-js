<!DOCTYPE html>
<html lang="en" data-theme="<%= userPreferences.theme %>">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= site.name %> - Modern Web Development Blog</title>
    <meta name="description" content="<%= site.description %>" />
    <meta name="author" content="<%= site.author %>" />
    <meta property="og:title" content="<%= site.name %>" />
    <meta property="og:description" content="<%= site.description %>" />
    <meta property="og:type" content="website" />
    <link rel="canonical" href="<%= site.url %>" />
    <link rel="stylesheet" href="/css/blog.css" />
    <script defer src="/js/blog-interactions.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="header-content">
        <div class="site-branding">
          <h1 class="site-title">
            <a href="/"><%= site.name %></a>
          </h1>
          <p class="site-tagline"><%= site.description %></p>
        </div>
        <nav class="main-nav" role="navigation" aria-label="Main navigation">
          <ul class="nav-list">
            <% site.navigation.forEach(function(item) { %>
            <li class="nav-item">
              <a href="<%= item.url %>" class="nav-link <%= item.url === '/' ? 'active' : '' %>">
                <%= item.name %>
              </a>
            </li>
            <% }); %>
          </ul>
        </nav>
        <div class="header-actions">
          <button class="theme-toggle" title="Toggle dark/light theme">🌓</button>
          <button class="view-toggle" title="Toggle compact view">📋</button>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="content-wrapper">
        <div class="main-column">
          <!-- Search and Filters -->
          <div class="search-filters">
            <form class="search-form" role="search">
              <div class="search-input-group">
                <label for="search" class="sr-only">Search posts</label>
                <input
                  type="search"
                  id="search"
                  name="q"
                  placeholder="Search posts..."
                  value="<%= searchQuery %>"
                  class="search-input"
                />
                <button type="submit" class="search-btn">🔍 Search</button>
              </div>
            </form>
            <div class="filter-controls">
              <select name="category" class="filter-select" title="Filter by category">
                <option value="">All Categories</option>
                <% categories.forEach(function(category) { %>
                <option value="<%= category %>" <%= selectedCategory === category ? 'selected' : '' %>>
                  <%= category %>
                </option>
                <% }); %>
              </select>
              <select name="sort" class="filter-select" title="Sort posts">
                <option value="publishedAt" <%= sortBy === 'publishedAt' ? 'selected' : '' %>>Latest First</option>
                <option value="views" <%= sortBy === 'views' ? 'selected' : '' %>>Most Popular</option>
                <option value="likes" <%= sortBy === 'likes' ? 'selected' : '' %>>Most Liked</option>
              </select>
            </div>
          </div>

          <!-- Featured Posts Section -->
          <% if (featuredPosts.length > 0) { %>
          <section class="featured-posts" aria-labelledby="featured-heading">
            <h2 id="featured-heading">Featured Posts</h2>
            <div class="featured-grid">
              <% featuredPosts.forEach(function(post) { %>
              <article class="featured-post">
                <div class="featured-content">
                  <div class="post-badge">Featured</div>
                  <h3>
                    <a href="/blog/<%= post.slug %>" class="featured-title">
                      <%= post.title %>
                    </a>
                  </h3>
                  <p class="featured-excerpt"><%= post.excerpt %></p>
                  <div class="featured-meta">
                    <span class="author">by <%= post.author.name %></span>
                    <span class="read-time"><%= post.readTime %> min read</span>
                    <span class="views"><%= post.views.toLocaleString() %> views</span>
                  </div>
                </div>
              </article>
              <% }); %>
            </div>
          </section>
          <% } %>

          <!-- Posts Section -->
          <section class="posts-section" aria-labelledby="posts-heading">
            <div class="section-header">
              <h2 id="posts-heading">
                <%= selectedCategory ? 'Posts in ' + selectedCategory : 'All Posts' %>
              </h2>
              <div class="posts-count"><%= posts.length %> posts found</div>
            </div>

            <% if (posts.length > 0) { %>
            <div class="posts-grid <%= userPreferences.compactView ? 'compact' : '' %>">
              <% posts.forEach(function(post) {
                var publishedDate = new Date(post.publishedAt);
                var isRecent = Date.now() - publishedDate.getTime() < 7 * 24 * 60 * 60 * 1000;
                var readTimeCategory = post.readTime <= 3 ? 'quick' : post.readTime <= 7 ? 'medium' : 'long';
              %>
              <article class="post-card <%= post.featured ? 'featured' : '' %> <%= userPreferences.compactView ? 'compact' : '' %>"
                       data-category="<%= post.category %>"
                       data-read-time="<%= readTimeCategory %>">
                <header class="post-header">
                  <div class="post-badges">
                    <% if (post.featured) { %>
                    <span class="badge featured">Featured</span>
                    <% } %>
                    <% if (isRecent) { %>
                    <span class="badge new">New</span>
                    <% } %>
                    <span class="badge category"><%= post.category %></span>
                  </div>
                  <h3 class="post-title">
                    <a href="/blog/<%= post.slug %>" class="post-link">
                      <%= post.title %>
                    </a>
                  </h3>
                  <div class="post-meta">
                    <div class="author-info">
                      <img src="https://via.placeholder.com/32x32?text=<%= post.author.name.split(' ').map(n => n[0]).join('') %>"
                           alt="<%= post.author.name %>"
                           class="author-avatar"
                           width="32" height="32" />
                      <div class="author-details">
                        <span class="author-name"><%= post.author.name %></span>
                        <span class="author-bio"><%= post.author.bio %></span>
                      </div>
                    </div>
                    <div class="post-timing">
                      <time datetime="<%= publishedDate.toISOString() %>"
                            class="publish-date"
                            title="Published on <%= publishedDate.toLocaleDateString() %>">
                        <%= publishedDate.toLocaleDateString() %>
                      </time>
                      <span class="read-time" title="Estimated reading time">
                        📖 <%= post.readTime %> min read
                      </span>
                    </div>
                  </div>
                </header>

                <% if (!userPreferences.compactView) { %>
                <div class="post-content">
                  <p class="post-excerpt"><%= post.excerpt %></p>
                  <% if (post.content.length > 500) { %>
                  <details class="content-preview">
                    <summary>Read more...</summary>
                    <div class="full-content">
                      <% post.content.split('\\n\\n').forEach(function(paragraph) { %>
                      <p><%= paragraph %></p>
                      <% }); %>
                    </div>
                  </details>
                  <% } %>
                </div>
                <% } %>

                <div class="post-tags">
                  <% post.tags.forEach(function(tag) { %>
                  <a href="/blog/tag/<%= encodeURIComponent(tag) %>" class="tag">
                    #<%= tag %>
                  </a>
                  <% }); %>
                </div>

                <footer class="post-stats">
                  <div class="engagement-stats">
                    <span class="stat views" title="<%= post.views.toLocaleString() %> views">
                      👁️ <%= post.views > 1000 ? Math.round(post.views / 1000) + 'k' : post.views %>
                    </span>
                    <span class="stat likes" title="<%= post.likes.toLocaleString() %> likes">
                      ❤️ <%= post.likes > 1000 ? Math.round(post.likes / 1000) + 'k' : post.likes %>
                    </span>
                    <span class="stat comments" title="<%= post.comments.toLocaleString() %> comments">
                      💬 <%= post.comments %>
                    </span>
                  </div>
                  <div class="post-actions">
                    <button class="action-btn bookmark" title="Bookmark this post">
                      🔖 Save
                    </button>
                    <button class="action-btn share" title="Share this post">
                      🔗 Share
                    </button>
                  </div>
                </footer>
              </article>
              <% }); %>
            </div>
            <% } else { %>
            <div class="no-posts">
              <h3>No posts found</h3>
              <p>Try adjusting your search or filter criteria to find more posts.</p>
              <a href="/blog" class="reset-filters">Reset filters</a>
            </div>
            <% } %>
          </section>

          <!-- Pagination -->
          <% if (posts.length > 0) { %>
          <nav class="pagination" role="navigation" aria-label="Pagination">
            <div class="pagination-info">
              <span>Page <%= currentPage %> of <%= totalPages %> (<%= totalPages * 10 %> total posts)</span>
            </div>
            <div class="pagination-controls">
              <% if (hasPrevPage) { %>
              <a href="/blog?page=1" class="page-link first" aria-label="Go to first page">« First</a>
              <a href="/blog?page=<%= currentPage - 1 %>" class="page-link prev" aria-label="Go to previous page">‹ Previous</a>
              <% } else { %>
              <span class="page-link disabled">« First</span>
              <span class="page-link disabled">‹ Previous</span>
              <% } %>

              <%
              var showPages = 5;
              var start = Math.max(1, currentPage - Math.floor(showPages / 2));
              var end = Math.min(totalPages, start + showPages - 1);
              if (end - start + 1 < showPages) {
                start = Math.max(1, end - showPages + 1);
              }
              for (var i = start; i <= end; i++) { %>
              <a href="/blog?page=<%= i %>"
                 class="page-link <%= i === currentPage ? 'current' : '' %>"
                 <%= i === currentPage ? 'aria-current="page"' : '' %>>
                <%= i %>
              </a>
              <% } %>

              <% if (hasNextPage) { %>
              <a href="/blog?page=<%= currentPage + 1 %>" class="page-link next" aria-label="Go to next page">Next ›</a>
              <a href="/blog?page=<%= totalPages %>" class="page-link last" aria-label="Go to last page">Last »</a>
              <% } else { %>
              <span class="page-link disabled">Next ›</span>
              <span class="page-link disabled">Last »</span>
              <% } %>
            </div>
          </nav>
          <% } %>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar">
          <!-- Analytics Dashboard -->
          <div class="analytics-dashboard">
            <h3>Blog Statistics</h3>
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-number"><%= totalPosts.toLocaleString() %></span>
                <span class="stat-label">Total Posts</span>
              </div>
              <div class="stat-item">
                <span class="stat-number"><%= analytics.totalViews.toLocaleString() %></span>
                <span class="stat-label">Total Views</span>
              </div>
              <div class="stat-item">
                <span class="stat-number"><%= analytics.totalLikes.toLocaleString() %></span>
                <span class="stat-label">Total Likes</span>
              </div>
              <div class="stat-item">
                <span class="stat-number"><%= analytics.avgReadTime %> min</span>
                <span class="stat-label">Avg Read Time</span>
              </div>
            </div>
          </div>

          <!-- Category Filter -->
          <div class="category-filter">
            <h3>Filter by Category</h3>
            <ul class="category-list">
              <li>
                <a href="/blog" class="category-link <%= selectedCategory === '' ? 'active' : '' %>">
                  All Posts
                </a>
              </li>
              <% categories.forEach(function(category) { %>
              <li>
                <a href="/blog?category=<%= encodeURIComponent(category) %>"
                   class="category-link <%= selectedCategory === category ? 'active' : '' %>">
                  <%= category %>
                </a>
              </li>
              <% }); %>
            </ul>
          </div>

          <!-- Popular Tags -->
          <div class="popular-tags">
            <h3>Popular Tags</h3>
            <div class="tag-cloud">
              <% popularTags.forEach(function(tag) { %>
              <a href="/blog/tag/<%= encodeURIComponent(tag.name) %>"
                 class="tag-link"
                 style="font-size: <%= Math.min(1.2 + tag.count * 0.1, 2) %>rem"
                 title="<%= tag.count %> posts">
                #<%= tag.name %>
                <span class="tag-count">(<%= tag.count %>)</span>
              </a>
              <% }); %>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="recent-activity">
            <h3>Recent Activity</h3>
            <ul class="activity-list">
              <% recentActivity.forEach(function(activity) { %>
              <li class="activity-item">
                <div class="activity-content">
                  <span class="activity-type"><%= activity.type %></span>
                  <a href="/blog/<%= activity.post.slug %>" class="activity-link">
                    <%= activity.post.title %>
                  </a>
                  <time class="activity-time">
                    <%= new Date(activity.timestamp).toLocaleDateString() %>
                  </time>
                </div>
              </li>
              <% }); %>
            </ul>
          </div>

          <!-- Newsletter Signup -->
          <div class="newsletter-signup">
            <h3>Stay Updated</h3>
            <p>Get notified about new posts and updates.</p>
            <form class="newsletter-form">
              <input type="email" placeholder="your@email.com" required class="newsletter-input" />
              <button type="submit" class="newsletter-btn">Subscribe</button>
            </form>
          </div>
        </aside>
      </div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-info">
          <p>&copy; <%= site.year %> <%= site.name %>. All rights reserved.</p>
          <p>Built with modern web technologies for optimal performance and accessibility.</p>
        </div>
        <div class="social-links">
          <a href="https://twitter.com/<%= site.social.twitter %>" class="social-link twitter" aria-label="Follow us on Twitter">
            🐦 Twitter
          </a>
          <a href="https://github.com/<%= site.social.github %>" class="social-link github" aria-label="View our GitHub repository">
            🐙 GitHub
          </a>
          <a href="https://linkedin.com/<%= site.social.linkedin %>" class="social-link linkedin" aria-label="Connect with us on LinkedIn">
            💼 LinkedIn
          </a>
        </div>
        <div class="footer-nav">
          <a href="/privacy">Privacy Policy</a>
          <a href="/terms">Terms of Service</a>
          <a href="/contact">Contact</a>
          <a href="/rss.xml">RSS Feed</a>
        </div>
      </div>
    </footer>

    <script>
      // Progressive enhancement for interactivity
      document.addEventListener('DOMContentLoaded', function() {
        // Theme toggle functionality
        const themeToggle = document.querySelector('.theme-toggle');
        if (themeToggle) {
          themeToggle.addEventListener('click', () => {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            html.setAttribute('data-theme', currentTheme === 'dark' ? 'light' : 'dark');
          });
        }
      });
    </script>
  </body>
</html>